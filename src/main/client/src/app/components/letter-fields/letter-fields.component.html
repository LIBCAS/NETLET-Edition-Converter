<div *ngIf="letter" class="app-letter">
  <button mat-flat-button color="primary" (click)="analyze()" class="app-mb-4">
    <mat-icon class="material-icons-outlined">search_insights</mat-icon>
    Analyze
  </button>
  
  <div class="app-mb-4">
    <mat-form-field class="app-w-100" appearance="outline">
      <mat-label>{{ 'field.full_text' | translate}}</mat-label>
      <textarea rows="5" matInput [(ngModel)]="letter.full_text" name="full_text"></textarea>
      <div class="app-pt-4 app-mb-n2 app-text-right">
        <ng-container *ngTemplateOutlet="icons; context:{ field: 'full_text' }"></ng-container>
      </div>
    </mat-form-field>
  </div>
  
  <div class="app-fxLayout app-row app-center-v app-mb-4">
    <mat-form-field class="app-fxFlex" appearance="outline">
      <mat-label>{{ 'field.author' | translate}}</mat-label>
      <input matInput [(ngModel)]="letter.author" name="author" /><span matSuffix></span>
      <ng-container matSuffix *ngTemplateOutlet="icons; context:{ field: 'author' }"></ng-container>
    </mat-form-field>
    <mat-icon (click)="switchAuthors()" class="app-ml-2 app-mr-2">sync_alt</mat-icon>
    <mat-form-field class="app-fxFlex" appearance="outline">
      <mat-label>{{ 'field.recipient' | translate}}</mat-label>
      <input matInput [(ngModel)]="letter.recipient" name="recipient"><span matSuffix></span>
      <ng-container matSuffix *ngTemplateOutlet="icons; context:{ field: 'recipient' }"></ng-container>
    </mat-form-field>
  </div>
  <div class="app-mb-4">
    <mat-form-field class="app-w-100" appearance="outline">
      <mat-label>{{ 'field.date_year' | translate}}</mat-label>
      <input matInput [(ngModel)]="letter.date_year" name="date_year"><span matSuffix></span>
      <ng-container matSuffix *ngTemplateOutlet="icons; context:{ field: 'date_year' }"></ng-container>
    </mat-form-field>
  </div>
  <div class="app-mb-4">
    <mat-form-field class="app-w-100" appearance="outline">
      <mat-label>{{ 'field.origin' | translate}}</mat-label>
      <input matInput [(ngModel)]="letter.origin" name="origin"><span matSuffix></span>
      <ng-container matSuffix *ngTemplateOutlet="icons; context:{ field: 'origin' }"></ng-container>
    </mat-form-field>
  </div>
  <div class="app-mb-4">
    <mat-form-field class="app-w-100" appearance="outline">
      <mat-label>{{ 'field.incipit' | translate}}</mat-label>
      <input matInput [(ngModel)]="letter.incipit" name="incipit"><span matSuffix></span>
      <ng-container matSuffix *ngTemplateOutlet="icons; context:{ field: 'incipit' }"></ng-container>
    </mat-form-field>
  </div>
  <div class="app-mb-4">
    <mat-form-field class="app-w-100" appearance="outline">
      <mat-label>{{ 'field.explicit' | translate}}</mat-label>
      <input matInput [(ngModel)]="letter.explicit" name="explicit"><span matSuffix></span>
      <ng-container matSuffix *ngTemplateOutlet="icons; context:{ field: 'explicit' }"></ng-container>
    </mat-form-field>
  </div>
    
  <!-- <button mat-flat-button color="primary" [disabled]="!letter.full_text" (click)="findTags()" class="app-mb-4">
    <mat-icon class="material-icons-outlined">system_update_alt</mat-icon>
    Extract entities
  </button>&#160;
  <button mat-flat-button color="primary" [disabled]="!letter.full_text" (click)="detectLang()" class="app-mb-4">
    <mat-icon class="material-icons-outlined">lang</mat-icon>
    {{ 'detect_lang' | translate}}
  </button>&#160;
  <button mat-flat-button color="primary" [disabled]="!letter.full_text" (click)="translate()" class="app-mb-4">
    <mat-icon class="material-icons-outlined">translate</mat-icon>
    {{ 'translate' | translate}}
  </button>
  <button mat-flat-button color="primary" [disabled]="!letter.full_text" (click)="annotate()" class="app-mb-4">
    <mat-icon class="material-icons-outlined">summarize</mat-icon>
    {{ 'annotate' | translate}}
  </button> -->
    <mat-form-field class="app-w-100" appearance="outline">
      <mat-label>{{ 'field.abstract' | translate}}</mat-label>
      <textarea rows="5" matInput [(ngModel)]="letter.abstract_cs" name="abstract" #abstract></textarea>
    </mat-form-field>
  <mat-tab-group>
    <mat-tab label="HIKO">
      <div class="app-pt-4 app-pb-4 app-pr-4">
        <div *ngFor="let entity of letter.entities">
          <mat-checkbox [id]="entity.id" [name]="entity.id" type="checkbox" [(ngModel)]="entity.selected" >{{ entity.key_cze }} ({{ entity.tenant }} - {{entity.type}})</mat-checkbox>
        </div>
      </div>
      <!-- <div class="app-fields-row">
        <mat-list role="list">
          <mat-list-item *ngFor="let entity of letter.entities" role="listitem">
            <input [id]="entity.id" [name]="entity.id" type="checkbox" [(ngModel)]="entity.selected" />
            <label [for]="entity.id">{{ entity.key_cze }} ({{ entity.tenant }} - {{entity.type}})</label>
          </mat-list-item>
        </mat-list>
      </div> -->
    </mat-tab>
    <mat-tab label="NameTag">
      <div class="app-pt-4 app-pb-4 app-pr-4">
        <div *ngFor="let entity of letter.nametags; let idx = index;">
          <mat-checkbox [id]="'nametag_' + idx" [name]="'nametag_' + idx" type="checkbox" [(ngModel)]="entity.selected">{{entity.text}} ({{ 'tags.' + entity.type | translate}})</mat-checkbox>
        </div>
      </div>
      <!-- <div class="app-fields-row">
        <mat-list role="list" *ngIf="nametags">
          <mat-list-item *ngFor="let entity of nametags; let idx = index;"  role="listitem">
            <input [id]="'nametag_' + idx" [name]="'nametag_' + idx" type="checkbox" [(ngModel)]="entity.selected" />
            <label [for]="'nametag_' + idx">{{entity.text}} ({{ 'tags.' + entity.type | translate}})</label>
          </mat-list-item>
        </mat-list>
      </div> -->
    </mat-tab>
  </mat-tab-group>
</div>

<ng-template #icons let-field="field">
  <mat-icon class="app-suffix app-color-block" (click)="setField(field, 'block', $event)" [matTooltip]="'action.set_block' | translate" >menu_open</mat-icon>
  <mat-icon class="app-suffix app-color-line"  (click)="setField(field, 'line', $event)" [matTooltip]="'action.set_line' | translate">menu_open</mat-icon>
  <mat-icon class="app-suffix app-color-word"  (click)="setField(field, 'word', $event)" [matTooltip]="'action.set_word' | translate">menu_open</mat-icon>
</ng-template>